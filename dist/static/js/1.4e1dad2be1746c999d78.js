webpackJsonp([1],{GEWs:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("mvHQ"),i=a.n(s),r={name:"ReportFeedback",data:function(){return{tableData:[],statusOptions:["待解决","解决中","已解决","待改进","改进中","已改进"],searchForm:{commiter:"",handlers:"",desc:"",solution:"",status:"",labels:[],feedBackTime:[]},currentPage:1,pageSize:10,total:0,filterData:[],allData:[],sortFunction:"",addDialogStatus:!1,editDialogStatus:!1,addForm:{commiter:"",handlers:"",status:"",desc:"",solution:"",labels:[],feedBackTime:"",source:"report_feedback"},editForm:{commiter:"",handlers:"",status:"",desc:"",solution:"",labels:[],feedBackTime:"",source:"report_feedback"}}},mounted:function(){var t=this;this.$store.dispatch("getTableData",{source:"report_feedback"}).then(function(e){t.allData=e.data,t.filterData=JSON.parse(i()(e.data)),t.total=t.allData.length,t.total>=t.pageSize?t.setTableData(t.allData.slice(0,t.pageSize)):t.setTableData(t.allData)})},methods:{addTags:function(t){var e=this;this.$prompt("","添加标签",{confirmButtonText:"确定",cancelButtonText:"取消",inputValidator:this.inputValidator}).then(function(a){var s=a.value;e.$store.dispatch("addLabel",{label:s}).then(function(a){0==a.code?e.$store.dispatch("getAllLabels").then(function(){e[t].labels.push(s)}):e.$message.error("添加失败")}).catch(function(t){e.$message.error("添加失败")})}).catch(function(){})},inputValidator:function(t){if(!t&&0!==t)return"不能为空";for(var e=0;e<this.LabelsOptions.length;e++)if(t==this.LabelsOptions[e])return"标签已存在";return!0},addCommit:function(){var t=this;if(""!==this.addForm.commiter)if(""!==this.addForm.handlers)if(0!=this.addForm.labels.length)if(""!==this.addForm.feedBackTime)if(""!==this.addForm.status)if(""!==this.addForm.desc)if(""!==this.addForm.solution){var e=this,a=JSON.parse(i()(this.addForm));a.handlers=a.handlers.split(";");var s=this.$message({message:"正在提交",iconClass:"el-icon-loading",duration:0});this.$store.dispatch("addTableData",a).then(function(a){0==a.code?(setTimeout(function(){s.close(),e.$message.success("添加成功"),e.addDialogStatus=!1},250),t.$store.dispatch("getTableData",{source:"report_feedback"}).then(function(e){t.allData=e.data,t.reset()})):(s.close(),e.$message.error("添加失败"))}).catch(function(t){s.close(),e.$message.error("添加失败")})}else this.$message.error("解决方案不能为空");else this.$message.error("描述不能为空");else this.$message.error("请选择状态");else this.$message.error("请选择反馈时间");else this.$message.error("标签至少选择一个");else this.$message.error("跟进处理人不能为空");else this.$message.error("反馈人不能为空")},rowClick:function(t){var e=this,a=JSON.parse(i()(t));a.handlers=a.handlers.join(";"),this.editForm=a,this.$nextTick(function(){e.editDialogStatus=!0})},showAddDialog:function(){this.addForm={commiter:"",handlers:"",status:"",desc:"",solution:"",labels:[],feedBackTime:"",source:"report_feedback"},this.addDialogStatus=!0},setTableData:function(t){var e=t;this.$set(this,"tableData",e)},commit:function(t,e){var a=this,s=this;if(""!==this.editForm.commiter)if(""!==this.editForm.handlers)if(0!=this.editForm.labels.length)if(""!==this.editForm.feedBackTime)if(""!==this.editForm.status)if(""!==this.editForm.desc)if(""!==this.editForm.solution){var r=JSON.parse(i()(this.editForm));r.handlers=r.handlers.split(";");var l=this.$message({message:"请稍等",iconClass:"el-icon-loading",duration:0});this.$store.dispatch("updateTableData",r).then(function(t){if(0==t.code)a.$store.dispatch("getTableData",{source:"report_feedback"}).then(function(t){a.allData=t.data,setTimeout(function(){l.close(),s.$message.success("修改成功"),s.filterData=JSON.parse(i()(s.filter(s.allData)));var t=s.currentPage;s.total>=t*s.pageSize?s.setTableData(s.filterData.slice((t-1)*s.pageSize,t*s.pageSize)):s.setTableData(s.filterData.slice((t-1)*s.pageSize,s.total)),s.editDialogStatus=!1},250)});else{l.close(),a.$message.error("修改失败");var e=a.currentPage;a.total>=e*a.pageSize?a.setTableData(a.filterData.slice((e-1)*a.pageSize,e*a.pageSize)):a.setTableData(a.filterData.slice((e-1)*a.pageSize,a.total))}}).catch(function(t){l.close(),a.$message.error("修改失败");var e=a.currentPage;a.total>=e*a.pageSize?a.setTableData(a.filterData.slice((e-1)*a.pageSize,e*a.pageSize)):a.setTableData(a.filterData.slice((e-1)*a.pageSize,a.total))})}else this.$message.error("解决方案不能为空");else this.$message.error("描述不能为空");else this.$message.error("请选择状态");else this.$message.error("请选择反馈时间");else this.$message.error("标签至少选择一个");else this.$message.error("跟进处理人不能为空");else this.$message.error("反馈人不能为空")},search:function(){this.$refs.commiter.columnConfig.order="",this.$refs.handler.columnConfig.order="",this.$refs.feedBackTime.columnConfig.order="",this.sortFunction="",this.filterData=JSON.parse(i()(this.filter(this.allData))),this.total=this.filterData.length,this.total>=this.pageSize?this.setTableData(this.filterData.slice(0,this.pageSize)):this.setTableData(this.filterData),this.currentPage=1},handleSizeChange:function(t){this.pageSize=t,this.total=this.filterData.length,this.total>=this.pageSize?this.setTableData(this.filterData.slice(0,this.pageSize)):this.setTableData(this.filterData),this.currentPage=1,this.$message.info("当前每页"+this.pageSize+"条数据")},handleCurrentChange:function(t){this.currentPage=t,this.total>=t*this.pageSize?this.setTableData(this.filterData.slice((t-1)*this.pageSize,t*this.pageSize)):this.setTableData(this.filterData.slice((t-1)*this.pageSize,this.total))},filter:function(t){var e=this,a=t;if(this.searchForm.commiter){var s=new RegExp(this.searchForm.commiter);a=a.filter(function(t){return t.commiter.match(s)})}if(this.searchForm.handlers){var i=new RegExp(this.searchForm.handlers);a=a.filter(function(t){return t.handlers.join(";").match(i)})}if(this.searchForm.status&&(a=a.filter(function(t){return t.status==e.searchForm.status})),this.searchForm.desc){var r=new RegExp(this.searchForm.desc);a=a.filter(function(t){return t.desc.match(r)})}if(this.searchForm.solution){var l=new RegExp(this.searchForm.solution);a=a.filter(function(t){return t.solution.match(l)})}return this.searchForm.feedBackTime.length>0&&(a=a.filter(function(t){return t.feedBackTime>=e.searchForm.feedBackTime[0]&&t.feedBackTime<e.searchForm.feedBackTime[1]+864e5})),this.searchForm.labels.length>0&&(a=a.filter(function(t){for(var a=0;a<e.searchForm.labels.length;a++)for(var s=0;s<t.labels.length;s++)if(e.searchForm.labels[a]==t.labels[s])return!0;return!1})),a},sort:function(t){if(!this.sortFunction||!this.sortFunction.order)return this.filterData=JSON.parse(i()(this.filter(this.allData))),this.filterData;switch(this.sortFunction.column.label){case"反馈人":return"ascending"==this.sortFunction.order?t.sort(function(t,e){return t.commiter.localeCompare(e.commiter,"zh-CN")}):t.sort(function(t,e){return e.commiter.localeCompare(t.commiter,"zh-CN")});case"跟进反馈人":return"ascending"==this.sortFunction.order?t.sort(function(t,e){return t.handlers.join("、").localeCompare(e.handlers.join("、"),"zh-CN")}):t.sort(function(t,e){return e.handlers.join("、").localeCompare(t.handlers.join("、"),"zh-CN")});case"反馈时间":return"ascending"==this.sortFunction.order?t.sort(function(t,e){return t.feedBackTime-e.feedBackTime}):t.sort(function(t,e){return e.feedBackTime-t.feedBackTime})}},reset:function(){this.$refs.commiter.columnConfig.order="",this.$refs.handler.columnConfig.order="",this.$refs.feedBackTime.columnConfig.order="",this.sortFunction="",this.searchForm={commiter:"",handlers:"",desc:"",solution:"",status:"",labels:[],feedBackTime:[]},this.filterData=JSON.parse(i()(this.filter(this.allData))),this.total=this.filterData.length,this.total>=this.pageSize?this.setTableData(this.filterData.slice(0,this.pageSize)):this.setTableData(this.filterData),this.currentPage=1},sortChange:function(t){this.sortFunction=t,this.filterData=this.sort(this.filterData),this.total=this.filterData.length,this.total>=this.pageSize?this.setTableData(this.filterData.slice(0,this.pageSize)):this.setTableData(this.filterData),this.currentPage=1}},computed:{LabelsOptions:function(){return this.$store.getters.Labels}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"ReportFeedback"}},[a("div",{staticClass:"ReportFeedback-header"},[a("div",{staticClass:"searchForm"},[a("span",{staticStyle:{"margin-right":"10px"}},[t._v("反馈人")]),a("el-input",{model:{value:t.searchForm.commiter,callback:function(e){t.$set(t.searchForm,"commiter",e)},expression:"searchForm.commiter"}}),a("span",{staticStyle:{margin:"0 10px"}},[t._v("处理人")]),a("el-input",{model:{value:t.searchForm.handlers,callback:function(e){t.$set(t.searchForm,"handlers",e)},expression:"searchForm.handlers"}}),a("span",{staticStyle:{margin:"0 10px",display:"inline-block",width:"56px"}},[t._v("描述")]),a("el-input",{model:{value:t.searchForm.desc,callback:function(e){t.$set(t.searchForm,"desc",e)},expression:"searchForm.desc"}}),a("span",{staticStyle:{margin:"0 10px"}},[t._v("解决方案")]),a("el-input",{model:{value:t.searchForm.solution,callback:function(e){t.$set(t.searchForm,"solution",e)},expression:"searchForm.solution"}}),a("span",{staticStyle:{margin:"0 10px",display:"inline-block",width:"42px"}},[t._v("状态")]),a("el-select",{attrs:{placeholder:""},model:{value:t.searchForm.status,callback:function(e){t.$set(t.searchForm,"status",e)},expression:"searchForm.status"}},t._l(t.statusOptions,function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})}),1)],1),t._v(" "),a("div",{staticClass:"searchForm"},[a("span",{staticStyle:{"margin-right":"10px",display:"inline-block",width:"42px"}},[t._v("标签")]),a("el-select",{staticClass:"tags",attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:t.searchForm.labels,callback:function(e){t.$set(t.searchForm,"labels",e)},expression:"searchForm.labels"}},t._l(t.LabelsOptions,function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})}),1),a("span",{staticStyle:{margin:"0 10px",display:"inline-block",width:"56px"}},[t._v("反馈时间")]),a("el-date-picker",{attrs:{type:"daterange","value-format":"timestamp","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.searchForm.feedBackTime,callback:function(e){t.$set(t.searchForm,"feedBackTime",e)},expression:"searchForm.feedBackTime"}}),a("el-button",{staticStyle:{"margin-left":"24px","margin-right":"6px"},attrs:{type:"primary"},nativeOn:{click:function(e){return t.search(e)}}},[t._v("查询")]),a("el-button",{staticStyle:{"margin-right":"6px"},attrs:{type:"info"},nativeOn:{click:function(e){return t.reset(e)}}},[t._v("重置")]),a("el-button",{attrs:{type:"success"},nativeOn:{click:function(e){return t.showAddDialog(e)}}},[t._v("新增")])],1)]),t._v(" "),a("div",{staticClass:"tableData"},[a("el-table",{ref:"ContentTable",staticClass:"ContentTable",attrs:{"row-key":"id",data:t.tableData,border:"","default-expand-all":""},on:{"row-click":t.rowClick,"sort-change":t.sortChange}},[a("el-table-column",{attrs:{prop:"id",label:"ID",width:"64"}}),t._v(" "),a("el-table-column",{ref:"commiter",attrs:{label:"反馈人",sortable:"",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{domProps:{innerHTML:t._s(e.row.commiter)}})]}}])}),t._v(" "),a("el-table-column",{ref:"handler",attrs:{label:"处理人",sortable:"",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._l(e.row.handlers,function(e,s){return[a("span",{key:s},[t._v(t._s(0==s?e:"、"+e))])]})]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"状态",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{domProps:{innerHTML:t._s(e.row.status)}})]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"标签","min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._l(e.row.labels,function(e,s){return[a("span",{key:s},[t._v(t._s(0==s?e:"、"+e))])]})]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"描述","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{domProps:{innerHTML:t._s(e.row.desc)}})]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"解决方案","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{domProps:{innerHTML:t._s(e.row.solution)}})]}}])}),t._v(" "),a("el-table-column",{ref:"feedBackTime",attrs:{label:"反馈时间",sortable:"",width:"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(t.$formatTime(e.row.feedBackTime,"yyyy-MM-dd"))+"\n        ")]}}])})],1),t._v(" "),a("el-pagination",{attrs:{"current-page":t.currentPage,"page-sizes":[10,15,20,25],"page-size":t.pageSize,background:"",layout:"total, sizes, prev, pager, next",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),t._v(" "),a("el-dialog",{staticClass:"dialog",attrs:{center:"",visible:t.addDialogStatus,title:"新增一条数据"},on:{"update:visible":function(e){t.addDialogStatus=e}}},[a("p",{staticClass:"dialog-title"},[t._v("反馈人")]),t._v(" "),a("el-input",{staticClass:"input-focus",attrs:{placeholder:""},model:{value:t.addForm.commiter,callback:function(e){t.$set(t.addForm,"commiter",e)},expression:"addForm.commiter"}}),t._v(" "),a("p",{staticClass:"dialog-title margin"},[t._v("跟进处理人")]),t._v(" "),a("el-input",{staticClass:"input-focus",attrs:{placeholder:"多个处理人中间用英文分号连接"},model:{value:t.addForm.handlers,callback:function(e){t.$set(t.addForm,"handlers",e)},expression:"addForm.handlers"}}),t._v(" "),a("p",{staticClass:"dialog-title margin"},[t._v("标签")]),t._v(" "),a("el-select",{staticClass:"input-focus",attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:t.addForm.labels,callback:function(e){t.$set(t.addForm,"labels",e)},expression:"addForm.labels"}},[a("li",{staticClass:"el-select-dropdown__item",staticStyle:{"text-align":"center","border-bottom":"1px solid #f0f0f0","padding-bottom":"40px"},on:{click:function(e){return t.addTags("addForm")}}},[a("span",[t._v("添加标签")])]),t._v(" "),t._l(t.LabelsOptions,function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})})],2),t._v(" "),a("p",{staticClass:"dialog-title margin"},[t._v("反馈时间")]),t._v(" "),a("el-date-picker",{staticClass:"input-focus",attrs:{"value-format":"timestamp",type:"date",placeholder:"请选择"},model:{value:t.addForm.feedBackTime,callback:function(e){t.$set(t.addForm,"feedBackTime",e)},expression:"addForm.feedBackTime"}}),t._v(" "),a("p",{staticClass:"dialog-title margin"},[t._v("状态")]),t._v(" "),a("el-select",{staticClass:"dialog-select",attrs:{placeholder:"请选择"},model:{value:t.addForm.status,callback:function(e){t.$set(t.addForm,"status",e)},expression:"addForm.status"}},t._l(t.statusOptions,function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})}),1),t._v(" "),a("p",{staticClass:"dialog-title margin"},[t._v("描述")]),t._v(" "),a("el-input",{staticClass:"input-focus",attrs:{placeholder:"",autosize:{minRows:2},type:"textarea"},model:{value:t.addForm.desc,callback:function(e){t.$set(t.addForm,"desc",e)},expression:"addForm.desc"}}),t._v(" "),a("p",{staticClass:"dialog-title margin"},[t._v("解决方案")]),t._v(" "),a("el-input",{staticClass:"input-focus",attrs:{placeholder:"",autosize:{minRows:2},type:"textarea"},model:{value:t.addForm.solution,callback:function(e){t.$set(t.addForm,"solution",e)},expression:"addForm.solution"}}),t._v(" "),a("div",{staticClass:"dialog-btn"},[a("p",{staticClass:"cancel",on:{click:function(e){t.addDialogStatus=!1}}},[t._v("取消")]),t._v(" "),a("P",{staticClass:"confirm",on:{click:t.addCommit}},[t._v("添加")])],1)],1),t._v(" "),a("el-dialog",{staticClass:"dialog",attrs:{center:"",visible:t.editDialogStatus,title:"编辑数据"},on:{"update:visible":function(e){t.editDialogStatus=e}}},[a("p",{staticClass:"dialog-title"},[t._v("反馈人")]),t._v(" "),a("el-input",{staticClass:"input-focus",attrs:{placeholder:""},model:{value:t.editForm.commiter,callback:function(e){t.$set(t.editForm,"commiter",e)},expression:"editForm.commiter"}}),t._v(" "),a("p",{staticClass:"dialog-title margin"},[t._v("跟进处理人")]),t._v(" "),a("el-input",{staticClass:"input-focus",attrs:{placeholder:"多个处理人中间用英文分号连接"},model:{value:t.editForm.handlers,callback:function(e){t.$set(t.editForm,"handlers",e)},expression:"editForm.handlers"}}),t._v(" "),a("p",{staticClass:"dialog-title margin"},[t._v("标签")]),t._v(" "),a("el-select",{staticClass:"input-focus",attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:t.editForm.labels,callback:function(e){t.$set(t.editForm,"labels",e)},expression:"editForm.labels"}},[a("li",{staticClass:"el-select-dropdown__item",staticStyle:{"text-align":"center","border-bottom":"1px solid #f0f0f0","padding-bottom":"40px"},on:{click:function(e){return t.addTags("editForm")}}},[a("span",[t._v("添加标签")])]),t._v(" "),t._l(t.LabelsOptions,function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})})],2),t._v(" "),a("p",{staticClass:"dialog-title margin"},[t._v("反馈时间")]),t._v(" "),a("el-date-picker",{staticClass:"input-focus",attrs:{"value-format":"timestamp",type:"date",placeholder:"请选择"},model:{value:t.editForm.feedBackTime,callback:function(e){t.$set(t.editForm,"feedBackTime",e)},expression:"editForm.feedBackTime"}}),t._v(" "),a("p",{staticClass:"dialog-title margin"},[t._v("状态")]),t._v(" "),a("el-select",{staticClass:"dialog-select",attrs:{placeholder:"请选择"},model:{value:t.editForm.status,callback:function(e){t.$set(t.editForm,"status",e)},expression:"editForm.status"}},t._l(t.statusOptions,function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})}),1),t._v(" "),a("p",{staticClass:"dialog-title margin"},[t._v("描述")]),t._v(" "),a("el-input",{staticClass:"input-focus",attrs:{placeholder:"",autosize:{minRows:2},type:"textarea"},model:{value:t.editForm.desc,callback:function(e){t.$set(t.editForm,"desc",e)},expression:"editForm.desc"}}),t._v(" "),a("p",{staticClass:"dialog-title margin"},[t._v("解决方案")]),t._v(" "),a("el-input",{staticClass:"input-focus",attrs:{placeholder:"",autosize:{minRows:2},type:"textarea"},model:{value:t.editForm.solution,callback:function(e){t.$set(t.editForm,"solution",e)},expression:"editForm.solution"}}),t._v(" "),a("div",{staticClass:"dialog-btn"},[a("p",{staticClass:"cancel",on:{click:function(e){t.editDialogStatus=!1}}},[t._v("取消")]),t._v(" "),a("P",{staticClass:"confirm2",on:{click:t.commit}},[t._v("保存")])],1)],1)],1)},staticRenderFns:[]};var o=a("VU/8")(r,l,!1,function(t){a("xLEd")},null,null);e.default=o.exports},xLEd:function(t,e){}});
//# sourceMappingURL=1.4e1dad2be1746c999d78.js.map